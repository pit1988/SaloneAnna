DROP TRIGGER IF EXISTS ControlloAppuntamentiSpeciali;
delimiter $$
CREATE TRIGGER controlloAppuntamentiSpeciali BEFORE INSERT ON Appuntamenti

FOR EACH ROW
BEGIN	
	DECLARE AppSpeciali INT;
	DECLARE Errore VARCHAR(20);
	SELECT count(*) INTO AppSpeciali FROM AppuntamentiSpeciali a JOIN Appuntamenti b
	WHERE b.DataOra>NEW.DataOra>(ADDTIME(b.DataOra,a.Durata));
IF(AppSpeciali) THEN 
		SELECT 'error 2: c e un appuntamento speciale, non si puo' INTO Errore FROM Appuntamenti LIMIT 1;
END IF;
END$$
delimiter ;

