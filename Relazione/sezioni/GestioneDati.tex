\section{Gestione Dati}{
	\subsection{Introduzione}{
		Il database è stato scritto con SQL, un tipo di linguaggio che permette di modificare e interrogare la base di dati con facilità e sicurezza. Tale tecnologia infatti permette di inserire, modificare, cancellare ed eseguire altre operazioni attraverso dei comandi specifici, eseguiti tramite delle istruzioni apposite di PHP. I dati salvati riguardano vari aspetti del sito, di cui la maggior parte viene usata per fornire dei servizi aggiuntivi all'amministratore.
	}
	\subsection{Descrizione delle entità}{
		Ogni entità ha un proprio codice identificativo, anche quando si potevano usare altri attributi come chiave primaria. In questo modo il sistema è solido anche in previsioni di modifiche future, ad esempio perché cambiano le necessità dell'azienda o si presentano dei casi particolari. Di seguito verranno descritte brevemente le entità utilizzate.
		\begin{itemize}
		\item Clienti contiene i dati dei clienti, ovvero il nome, il cognome, il telefono, l'email e la data di nascita; i primi quattro attributi sono delle stringhe, mentre la data è di tipo Date, un tipo che salva il valore nel formato yyyy-mm-gg, dove 'y' rappresenta le cifre degli anni, 'm' quella dei mesi e g quella dei giorni.
		\item TipoAppuntamento contiene i possibili tipi di appuntamento, quindi possiede come attributi il nome, di tipo stringa, il costo del servizio e lo sconto che l'amministratore vuole applicare, entrambi di tipo numerico.
		\item Appuntamenti contiene i dati relativi ai singoli appuntamenti, quindi il codice del tipo, il codice del cliente e l'orario prenotato; quest'ultimo è di tipo DateTime, ovvero contiene la data, nel formato descritto in Clienti, e l'ora, rappresentata nel formato hh:mm:ss, dove 'h' rappresenta le cifre dell'ora, 'm' quelle dei minuti e 's' quelle dei secondi.
		\item Prodotti contiene i dati di ogni prodotto presente nel magazzino dell'azienda, è caratterizzato dagli attributi nome, marca, tipo, quantità, prezzo e prezzo di rivendita. ‘‘Nome’’ indica il nome che identifica l'oggetto, ‘‘marca’’ è il nome dell'azienda che vende il prodotto, ‘‘tipo’’ indica per quale uso è destinato l'oggetto descritto, ‘‘quantità’’ distingue i prodotti che differiscono fra loro solo per la dimensione del contenitore, ad esempio quando ho un flacone che contiene 250 ml di prodotto e un altro che ne contiene 400 ml, ‘‘prezzo’’ indica quando costa l'acquisto del prodotto, ‘‘prezzo di rivendita’’ infine rappresenta il prezzo che deve pagare il cliente per acquistare quel prodotto. Nome, marca e tipo sono stringhe, invece quantità, prezzo e prezzo di rivendita sono di tipo numerico. 
		\item ProdApp contiene i prodotti usati durante gli appuntamenti, permette così di memorizzare quali e quanti prodotti sono stati usati per ogni appuntamento; i dati che lo caratterizzano sono il codice dell'appuntamento, il codice del prodotto, che insieme rappresentano la chiave primaria dell'entità, e la quantità utilizzata, ovvero quanto prodotto è stato usato durante l'appuntamento. Tutti i campi sono di tipo numerico.
		\item Account contiene i dati relativi agli account degli amministratori, viene usato quando l'utente tenta di eseguire la login nel sito. I campi che contiene sono username e password, entrambi di tipo stringa.
		\item Messaggi contiene i messaggi inviati agli amministratori. Essi sono caratterizzati dal codice del cliente, di tipo intero, dal contenuto, di tipo stringa, dall'orario in cui vengono ricevuti dal server, di tipo DateTime, e dal valore booleano ToRead, che indica se il messaggio è ancora da leggere.
		\item Immagini contiene le informazioni relative alle immagini caricate nella pagina ‘‘Foto’’ del sito, gli attributi di cui è composta sono la descrizione e il nome, entrambi di tipo stringa. In particolare la descrizione è il messaggio che viene stampato sulla pagina per indicare all'utente cosa è rappresentato nella foto, mentre il nome serve per le operazioni di modifica o eliminazione del file.
		\item Contatori è una View, ossia è una specie di entità i cui dati non vengono inseriti direttamente dall'utente, bensì sono ricavati dai valori di altre entità. In questo caso le informazioni riportate riguardano la statistica degli appuntamenti in base al tipo: i campi previsti sono quindi ‘‘Tipo’’, dove viene salvato il codice dei tipi di appuntamento, e ‘‘Parziali’’, dove viene salvato il numero di appuntamenti di quel tipo presenti nel database.
		\end{itemize}
	}
	\subsection{Codice PHP per l'interazione con il database}{
	\label{sec:PHPDB}
		Quasi tutte le funzioni PHP che gestiscono l'interazione tra il sito e il database sono contenute nel file ‘‘DBlibrary.php’’ dentro la cartella ‘‘utils’’. Tra di esse le più importanti sono ‘‘dbconnect’’, in cui sono contenute tutte le istruzioni per poter collegarsi al database SQL, in modo da poter eseguire facilmente le query, e ‘‘cleanString’’, che esegue delle pulizie di base sulla stringa passata come parametro, ovvero trasforma i caratteri speciali in entità HTML ed elimina gli spazi e le tabulazioni che possono essere presenti all'inizio o alla fine della stringa.
		Tutte le altre funzioni invece rappresentano delle query da dover eseguire sul database, a parte un paio di esse che sono di supporto. È possibile suddividerle in alcuni gruppi, dato che molte di esse lavorano allo stesso modo ma su entità diverse: le funzioni del tipo ‘‘lista’’ (listaClienti, listaAppuntamenti, eccetera) prelevano dal database tutti i dati relativi all'entità a cui fanno riferimento, li salvano in un array di oggetti e restituiscono quest'ultimo all'utente; le funzioni del tipo ‘‘aggiungi’’ inseriscono una nuova istanza nel database in base ai parametri forniti alla funzione, ovviamente non prima che essi vengano controllati; le funzioni del tipo ‘‘elimina’’ cancellano un'istanza del database in base al codice fornito; le funzioni del tipo ‘‘aggiorna’’ modificano un'istanza in base al codice e ai parametri forniti, dopo che questi ultimi vengono controllati; le funzioni ‘‘mostra’’ restituiscono i dati relativi ad una precisa istanza, in base al codice fornito alla funzione; infine le altre funzioni eseguono delle query più specifiche, che non hanno nulla in comune né tra loro né con le funzioni descritte prima.
		I tipi restituiti si possono dividere in due categorie: la prima è rappresentata da un singolo oggetto o un array di oggetti, dove il valore che segnala la presenza di errori a chi chiama la funzione è ‘‘NULL’’; la seconda è rappresentata da un valore booleano, dove ‘‘TRUE’’ indica che l'esecuzione della query è andata a buon fine, mentre ‘‘FALSE’’ segnala che ci sono stati dei problemi. Questi ultimi possono essere di vario tipo, ad esempio se il database non è accessibile, se la connessione si interrompe all'improvviso o se la query eseguita non è corretta.
		I controlli sui dati vengono effettuati in ogni funzione che prevede dei parametri, perché ognuno di essi generalmente viene ottenuto da un input richiesto all'utente, che può essere errato e quindi può generare problemi. In particolare se JavaScript è disattivato avere questi controlli è fondamentale, in quanto non c'è alcuna garanzia che il formato dei dati non causi problemi. Un altro problema è causato dai caratteri speciali, che non possono essere salvati nel database e quindi devono essere trasformati nella corrispondente entità HTML; questa operazione inoltra aiuta la stampa degli oggetti nelle pagine HTML, perché non occorre verificare che non ci siano caratteri speciali nel testo da stampare. Nelle stringhe inoltre viene controllato se ci sono degli spazi all'inizio o alla fine, perché sono caratteri inutili che possono comparire per vari motivi, come un errore dell'utente, e possono provocare dei problemi, ad esempio nel database le dimensioni degli attributi sono limitate e quindi dei caratteri di troppo possono rischiare di tagliare una parte dei dati inseriti dall'utente.
		Solo i parametri di tipo stringa vengono controllati, dato che in genere gli altri tipi segnalano errore se sono presenti dei caratteri errati; ad esempio se l'utente deve inserire un numero e aggiunge un carattere speciale allora la query fallirà, in quanto viene inviato un valore di tipo stringa dove è atteso un numero. Un altro caso particolare riguarda le date, che subiscono un controllo del formato molto più severo e quindi non vengono verificate con i metodi delle altre stringhe, in quanto i casi in cui tali istruzioni sono necessarie non passano i controlli usati dalle date. Infine gli attributi ‘‘Telefono’’ di ‘‘Cliente’’ e ‘‘Img_filename’’ di ‘‘Images’’ subiscono un'ulteriore operazione: vengono individuati ed eliminati tutti gli spazi contenuto al loro interno; questo perché altrimenti il loro formato risulterebbe errato rispetto a quello previsto.
	}
}